#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>

#define ERR -1

void create_ps(int n) {
    pid_t pid;
    if(n == 1) return;
    if((pid = fork()) == ERR) perror("Fork"), exit(3);
    create_ps((n>>1)+((pid)&(n&1)));
}

int main(int argc, char* argv[]) {
    int n;
    if(argc != 2) fprintf(stderr, "One parameter: number of processus to create\n"), exit(1);
    n = atoi(*(argv+1));
    if(n < 1) fprintf(stderr, "Strictly positif argument needed.\n"), exit(2);
    create_ps(n);
    //for(;n>1;n=(n>>1)+((pid)&&(n&1))) {if((pid=fork())==ERR) perror("Fork"), exit(3);} // PLUS EFFICACE
    printf("Processus id: %d\n", getpid());
}