/* writer-readers problem */

typedef int sem;


// SHARED VARIABLES
int cpt = 0;
sem mutex = 1;
sem db = 1;

// WRITER
void writer() {
    produce_data();

    P(db);
    write_db();
    V(db);
}

// READER
void reader() {
    P(mutex);
    if(++cpt == 1) P(db);
    V(mutex);
    read_db();
    P(mutex);
    if(!cpt--) V(db);
    V(mutex);

    use_data();
}