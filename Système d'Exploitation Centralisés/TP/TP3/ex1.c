#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <time.h>
#include <unistd.h>

#define ERR -1
#define FORK_ERR 1
#define errsys(n) perror(taberr[n]), exit(n);

char* taberr[] = {
    "No Error",
    "Fork error"
};

pid_t pid;
int pere = 0;
int score = 0;

int timeout ( int seconds )
{
    clock_t endwait;
    endwait = clock () + seconds * CLOCKS_PER_SEC ;
    while (clock() < endwait) {}

    return  1;
}

void rien(int s){
    return;
}

void fin(int s){
    if(pere) kill(pid, SIGINT);
    printf("fin de l'exercice\n");
    exit(0);
}

int main(void) {
    int status;
    srand((unsigned int)time(NULL));

    signal(SIGUSR1,rien);
    signal(SIGINT,fin);


    if(pid){
        for(;;) {
            if((pid=fork()) == ERR) errsys(1);
            
            int a = (rand()%7)+2;
            int b = (rand()%7)+2;

            printf("What's %d x %d ?\n", a, b);
            wait(&status);
            if(WIFEXITED(status) && status == (a*b)) score++;
        }
    }
    else {
        while(!scanf("%d%*[^\n]%*c",&status) || scanf("%*[^0-9-]%d%*[^\n]%*c", &status));
        exit(status);
    }
}