#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <time.h>
#include <unistd.h>

#define ERR -1
#define FORK_ERR 1
#define errsys(n) perror(taberr[n]), exit(n);

char* taberr[] = {
    "No Error",
    "Fork error"
};

pid_t pid;
int pere = 0;
int score = 0;
int a, b;

void rien(int s){
    sleep(5);
}

void fin(int s){
    if(pere) kill(pid, SIGINT);
    printf("fin de l'exercice\n");
    exit(0);
}

int main(void) {
    int status;
    srand((unsigned int)time(NULL));

    signal(SIGALRM,rien);

    signal(SIGINT,fin);

    if((pid=fork()) == ERR) errsys(1);

    if(pid) {
        for(;;) {
            a = (rand()%8)+2;
            b = (rand()%8)+2;
            printf("How much is %d x %d ?\n", a, b);
            // sleep(5);
            wait(&status);
            if(WIFEXITED(status) && status == (a*b)){ 
                score++; 
                printf("received: %d\n", status);
            }
        }
    }
    if(!pid) {
        status = 0;
        scanf("%d", &status);
        exit(status);
    }
}