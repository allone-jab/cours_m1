#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>

#define ERR -1

int main(){
    pid_t pid;
    int status;

    printf("Je suis le PERE, mon pid=%d, mon ppid=%d\n", getpid(), getppid()); // Q4
    if((pid = fork()) == ERR) perror("Fork"), exit(1);

    if(!pid){
        printf("Je suis le FILS, mon pid=%d, mon ppid=%d\n", getpid(), getppid());
        scanf("%d", &status);
        if(status < 0 || status > 128) fprintf(stderr, "Incorrect number\n"), exit(2);
        exit(status);
    } else {
        wait(&status);
        if(WIFEXITED(status)) printf("Mon fils a retourné le statut: %d\n", WEXITSTATUS(status));
        else fprintf(stderr, "Mon fils a été tué. :'(\n"), exit(4);
    }
    return(0);
}